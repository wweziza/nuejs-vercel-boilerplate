function F(j,x=document){return x.querySelector(j)}function J(j,x=document){return[...x.querySelectorAll(j)]}var Z={};async function U(j,x){if(dispatchEvent(new Event("before:route")),Z[location.pathname]=window.scrollY,!x)history.pushState({path:j},0,j);let z=q(await v(j)),E=F("title",z)?.textContent;if(E)document.title=E;let G='[name="nue:components"]';F(G).content=F(G,z).content;for(let I of J("script[src]",z))await import(I.getAttribute("src"));let N=A(z);P(N,()=>{let I=V(F("main"),F("main",z));V(F("body"),F("body2",z),I);let{hash:Q}=location,O=Q&&F(Q);scrollTo(0,O?O.offsetTop-parseInt(getComputedStyle(O).scrollMarginTop)||0:0),dispatchEvent(new Event("route"));let[S,C]=location.pathname.split("/");dispatchEvent(new Event(`route:${C||"home"}`)),B(j)})}function H(j,x){j.addEventListener("click",(z)=>{let E=z.target.closest("[href]"),G=E?.getAttribute("href"),N=E?.getAttribute("target"),I=G?.split("/")?.pop()?.split(/[#?]/)?.shift();if(z.defaultPrevented||z.metaKey||z.ctrlKey||z.shiftKey||z.altKey||!G||G[0]=="#"||G?.includes("//")||G?.startsWith("mailto:")||I?.includes(".")&&!I?.endsWith(".html")||!!N)return;if(G!=location.pathname)x(E.pathname,E);z.preventDefault()})}function K(j){let x=location.pathname;return x.slice(0,x.lastIndexOf("/")+1)+j}function B(j,x="aria-current"){if(j[0]!="/")j=K(j);J(`[${x}]`).forEach((z)=>z.removeAttribute(x)),J("a").forEach((z)=>{if(!z.hash&&z.pathname==j)setTimeout(()=>z.setAttribute(x,"page"),50)})}function L(){if(!document.startViewTransition)document.startViewTransition=(j)=>j();history.pushState({path:location.pathname},0),H(document,async(j,x)=>{let z=F("img",x);if(z)z.style.viewTransitionName="active-image";document.startViewTransition(async()=>{await U(j)})}),B(location.pathname),addEventListener("popstate",(j)=>{let{path:x}=j.state||{};if(x){let z=Z[x];document.startViewTransition(async()=>{await U(x,!0),setTimeout(()=>window.scrollTo(0,z||0),10)})}})}function M(j,x){if(j.length!=x.length)return!1;for(let z=0;z<j.length;z++)if(j[z].tagName!=x[z].tagName)return!1;return!0}function V(j,x,z){if(!j||!x)return!0;if(M(j.children,x.children))return[...j.children].forEach((E,G)=>{if(!(z&&E.tagName=="MAIN"))R(E,x.children[G])}),!0;else j.innerHTML=x.innerHTML}function R(j,x){if(j.outerHTML.replace(' aria-current="page"',"")!=x.outerHTML)j.replaceWith(x.cloneNode(!0))}function A(j){let x=J("link, style"),z=D(x,J("link, style",j));return z.forEach((E)=>F("head").appendChild(E)),T(j),z.filter((E)=>E.tagName=="link")}function W(j,x){return x.find((z)=>z.getAttribute("href")==j.getAttribute("href"))}function D(j,x){return j.forEach((z,E)=>z.disabled=!W(z,x)),x.filter((z)=>!W(z,j))}function X(j){return J("style",j).find((x)=>!x.attributes.length)}function T(j){let x=X(),z=X(j);if(x)x.replaceWith(z);else if(z)F("head").appendChild(z)}var Y={};async function v(j){let x=Y[j];if(x)return x;let z=await fetch(j);if(x=await z.text(),z.status==404&&x?.trim()[0]!="<"){let E=document.title="Page not found";F("article").innerHTML=`<section><h1>${E}</h1></section>`}else Y[j]=x;return x}function q(j){j=j.replace(/<(\/?)body/g,"<$1body2");let x=document.createElement("template");return x.innerHTML=j.trim(),x.content}function P(j,x){let z=0;!j[0]?x():j.forEach((E,G)=>{w(E.href,()=>{if(++z==j.length)x()})})}function w(j,x){let z=document.createElement("link");z.rel="stylesheet",z.href=j,F("head").appendChild(z),z.onload=x}if(typeof window=="object")L();export{L as setupTransitions,B as setActive,H as onclick,U as loadPage,J as $$,F as $};
